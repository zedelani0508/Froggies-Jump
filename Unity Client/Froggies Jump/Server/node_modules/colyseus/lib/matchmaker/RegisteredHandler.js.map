{"version":3,"file":"RegisteredHandler.js","sourceRoot":"","sources":["../../src/matchmaker/RegisteredHandler.ts"],"names":[],"mappings":";;;AAAA,mCAAsC;AAItC,mCAAsC;AAEzB,QAAA,mBAAmB,GAAiC;IAC/D,SAAS;IACT,QAAQ;IACR,SAAS;IACT,6DAA6D;IAC7D,UAAU;IACV,MAAM;IACN,WAAW;IACX,QAAQ;CACT,CAAC;AAIF,MAAa,iBAAkB,SAAQ,qBAAY;IAOjD,YAAY,KAAsB,EAAE,OAAY;QAC9C,KAAK,EAAE,CAAC;QAJH,kBAAa,GAAa,EAAE,CAAC;QAMlC,IAAI,OAAM,CAAC,KAAK,CAAC,KAAK,UAAU,EAAE;YAChC,OAAO,CAAC,KAAK,CAAC,yDAAyD,CAAC,CAAC;YACzE,MAAM,IAAI,KAAK,CAAC,yBAAyB,OAAM,CAAC,KAAK,CAAC,gBAAgB,CAAC,CAAC;SACzE;QAED,IAAI,CAAC,KAAK,GAAG,KAAK,CAAC;QACnB,IAAI,CAAC,OAAO,GAAG,OAAO,CAAC;IACzB,CAAC;IAEM,qBAAqB;QAC1B,IAAI,CAAC,EAAE,CAAC,QAAQ,EAAE,CAAC,IAAI,EAAE,EAAE,CAAC,mBAAW,CAAC,IAAI,CAAC,CAAC,CAAC;QAC/C,IAAI,CAAC,EAAE,CAAC,MAAM,EAAE,CAAC,IAAI,EAAE,EAAE,CAAC,mBAAW,CAAC,IAAI,CAAC,CAAC,CAAC;QAC7C,IAAI,CAAC,EAAE,CAAC,QAAQ,EAAE,CAAC,IAAI,EAAE,EAAE,CAAC,mBAAW,CAAC,IAAI,CAAC,CAAC,CAAC;QAC/C,IAAI,CAAC,EAAE,CAAC,MAAM,EAAE,CAAC,IAAI,EAAE,EAAE,CAAC,mBAAW,CAAC,IAAI,CAAC,CAAC,CAAC;QAC7C,IAAI,CAAC,EAAE,CAAC,OAAO,EAAE,CAAC,IAAI,EAAE,CAAC,EAAE,WAAW,EAAE,EAAE;YACxC,IAAI,CAAC,WAAW,EAAE;gBAChB,mBAAW,CAAC,IAAI,CAAC,CAAC;aACnB;QACH,CAAC,CAAC,CAAC;QACH,IAAI,CAAC,EAAE,CAAC,SAAS,EAAE,CAAC,IAAI,EAAE,EAAE,CAAC,mBAAW,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC,CAAC;QACtD,OAAO,IAAI,CAAC;IACd,CAAC;IAEM,QAAQ,CAAC,OAAiB;QAC/B,IAAI,CAAC,aAAa,GAAG,OAAO,CAAC;QAC7B,OAAO,IAAI,CAAC;IACd,CAAC;IAEM,MAAM,CAAC,OAAoB;QAChC,IAAI,CAAC,WAAW,GAAG,OAAO,CAAC;QAC3B,OAAO,IAAI,CAAC;IACd,CAAC;IAEM,gBAAgB,CAAC,OAAY;QAClC,OAAO,IAAI,CAAC,aAAa,CAAC,MAAM,CAAC,CAAC,IAAI,EAAE,IAAI,EAAE,CAAC,EAAE,GAAG,EAAE,EAAE;YACtD,MAAM,KAAK,GAAG,GAAG,CAAC,CAAC,CAAC,CAAC;YACrB,IAAI,OAAO,CAAC,KAAK,CAAC,EAAE;gBAClB,IAAI,2BAAmB,CAAC,OAAO,CAAC,KAAY,CAAC,KAAK,CAAC,CAAC,EAAE;oBACpD,OAAO,CAAC,IAAI,CAAC,WAAW,KAAK,kDAAkD,CAAC,CAAC;iBAElF;qBAAM;oBACL,IAAI,CAAC,KAAK,CAAC,GAAG,OAAO,CAAC,KAAK,CAAC,CAAC;iBAC9B;aACF;YACD,OAAO,IAAI,CAAC;QACd,CAAC,EAAE,EAAE,CAAC,CAAC;IACT,CAAC;CACF;AAzDD,8CAyDC","sourcesContent":["import { EventEmitter } from 'events';\n\nimport { RoomConstructor } from './../Room';\nimport { RoomListingData } from './drivers/Driver';\nimport { updateLobby } from './Lobby';\n\nexport const INVALID_OPTION_KEYS: Array<keyof RoomListingData> = [\n  'clients',\n  'locked',\n  'private',\n  // 'maxClients', - maxClients can be useful as filter options\n  'metadata',\n  'name',\n  'processId',\n  'roomId',\n];\n\nexport interface SortOptions { [fieldName: string]: 1 | -1 | 'asc' | 'desc' | 'ascending' | 'descending'; }\n\nexport class RegisteredHandler extends EventEmitter {\n  public klass: RoomConstructor;\n  public options: any;\n\n  public filterOptions: string[] = [];\n  public sortOptions?: SortOptions;\n\n  constructor(klass: RoomConstructor, options: any) {\n    super();\n\n    if (typeof(klass) !== 'function') {\n      console.debug('You are likely not importing your room class correctly.');\n      throw new Error(`class is expected but ${typeof(klass)} was provided.`);\n    }\n\n    this.klass = klass;\n    this.options = options;\n  }\n\n  public enableRealtimeListing() {\n    this.on('create', (room) => updateLobby(room));\n    this.on('lock', (room) => updateLobby(room));\n    this.on('unlock', (room) => updateLobby(room));\n    this.on('join', (room) => updateLobby(room));\n    this.on('leave', (room, _, willDispose) => {\n      if (!willDispose) {\n        updateLobby(room);\n      }\n    });\n    this.on('dispose', (room) => updateLobby(room, true));\n    return this;\n  }\n\n  public filterBy(options: string[]) {\n    this.filterOptions = options;\n    return this;\n  }\n\n  public sortBy(options: SortOptions) {\n    this.sortOptions = options;\n    return this;\n  }\n\n  public getFilterOptions(options: any) {\n    return this.filterOptions.reduce((prev, curr, i, arr) => {\n      const field = arr[i];\n      if (options[field]) {\n        if (INVALID_OPTION_KEYS.indexOf(field as any) !== -1) {\n          console.warn(`option \"${field}\" has internal usage and is going to be ignored.`);\n\n        } else {\n          prev[field] = options[field];\n        }\n      }\n      return prev;\n    }, {});\n  }\n}\n"]}